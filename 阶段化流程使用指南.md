# 阶段化流程使用指南

## 🎯 快速开始

### 1. 打开应用
```bash
cd /Users/moxin/Qcoder/overseas-company-setup
open index.html
```

### 2. 测试基础流程

#### **测试场景1: 香港公司注册 (标准流程)**
1. 填写表单:
   - 注册地: `Hong Kong (香港)`
   - 公司名称: `Test Company Limited`
   - 公司类型: `★ Private Limited Company (私人有限公司) - Ltd`
   - 股东: 添加1-2位股东
   - 董事: 添加1位董事
   - 收件国家: `China (中国)`

2. 点击"Submit (提交)"

3. 选择供应商 → 点击"View Detailed Process (查看详细流程)"

4. 观察结果:
   - ✅ 看到4个阶段 (Phase 1-4)
   - ✅ 每个阶段有清晰的紫色渐变标题
   - ✅ 每个阶段下有多个具体任务
   - ✅ 任务显示责任方、所需文件、风险等详细信息
   - ✅ 总工作日约6天 + 快递时间

---

#### **测试场景2: 新加坡公司注册 (含并行任务)**
1. 填写表单:
   - 注册地: `Singapore (新加坡)`
   - 其他信息同上

2. 查看流程详情

3. **重点观察 Phase 4**:
   ```
   Phase 4: Tax Registration and Seal Production (税务登记与印章制作)
   
   ⚡ Parallel Tasks (并行处理 2 items) - 可同时进行
   
   ├─ Task 4.1: Tax Registration (税务登记) - 1天
   │   [绿色边框标识并行]
   │
   └─ Task 4.2: Seal Production (刻制印章) - 1天
       [绿色边框标识并行]
   
   Phase实际时长: 1天 (而非2天)
   ```

4. 验证:
   - ✅ 看到绿色横幅 "⚡ Parallel Tasks"
   - ✅ 两个任务都有绿色左边框
   - ✅ Phase 4总时长 = 1天 (并行优化)
   - ✅ 总工作日 = 8天 (而非9天)

---

#### **测试场景3: 多股东/董事影响时长**
1. 填写表单:
   - 注册地: `Hong Kong (香港)`
   - **股东: 添加5位股东** (测试时长增加)
   - **董事: 添加3位董事**

2. 查看流程

3. 对比结果:
   - 标准流程(2股东1董事): Phase 1约2天
   - 多人流程(5股东3董事): Phase 1约2.6天
   - ✅ 文件准备时间自动增加

4. 查看风险提示区域:
   - ✅ 看到 "⚠️ Multiple Shareholders (多股东提示)"
   - ✅ 看到 "ℹ️ Multiple Directors (多董事说明)"

---

#### **测试场景4: 额外服务 (银行开户)**
1. 填写表单:
   - 注册地: `Hong Kong (香港)`
   - **勾选额外服务: ✓ Bank Account Opening (银行开户)**

2. 查看流程

3. 观察结果:
   - ✅ 在最后看到新增 "Phase 5: Bank Account Opening Assistance"
   - ✅ 总工作日增加约7天
   - ✅ 风险提示中增加银行开户说明

---

### 3. 运行测试脚本

在浏览器控制台运行完整测试:

1. 打开浏览器开发者工具 (F12)
2. 切换到 Console 标签
3. 复制 `test-phases.js` 的内容
4. 粘贴到控制台并回车
5. 查看测试结果:
   ```
   === 流程阶段化功能测试 ===
   
   测试1: 检查process.js数据结构
   ✓ 香港 supplier_a 存在
     - totalWorkingDays: 6
     - phases数量: 4
     - Phase 1名称: Preparation Phase (准备阶段)
     - Phase 1任务数: 2
   ✓ 数据结构正确
   
   测试2: 检查并行任务支持
   ✓ 并行任务支持正常
   
   ... (更多测试结果)
   
   === 测试完成 ===
   ```

---

## 🔍 功能验证清单

### 基础显示
- [ ] 阶段标题紫色渐变背景正常
- [ ] 阶段编号标签显示清晰
- [ ] 阶段时长白底高亮
- [ ] 任务编号蓝色圆形徽章
- [ ] 任务元信息完整 (⏱时长 📅时间轴 👤责任方)

### 并行任务
- [ ] 并行任务显示绿色横幅 "⚡ Parallel Tasks"
- [ ] 并行任务左侧绿色边框
- [ ] 并行任务时间计算正确 (取最大值)
- [ ] 串行任务左侧蓝色边框

### 详细信息
- [ ] 📄 所需文件 - 蓝色背景
- [ ] ✅ 要求 - 绿色背景
- [ ] ⚠️ 风险提示 - 黄色背景
- [ ] 📦 交付物 - 紫色标签
- [ ] 🚚 快递信息 (仅快递任务显示)

### 动态计算
- [ ] 子地区选择影响时长
- [ ] 股东/董事数量影响时长
- [ ] 额外服务增加阶段
- [ ] 快递时间动态计算

### 交互体验
- [ ] 阶段卡片 hover 效果 (边框变蓝、阴影、上移)
- [ ] 任务卡片 hover 效果 (背景变白、边框变蓝、阴影)
- [ ] 页面滚动流畅
- [ ] 响应式布局 (手机端测试)

---

## 📱 响应式测试

### 桌面端 (>768px)
1. 打开浏览器
2. 正常宽度查看
3. 验证:
   - 阶段头部横向布局
   - 任务元信息横向排列
   - 所有详细信息完整显示

### 移动端 (<768px)
1. 打开浏览器开发者工具 (F12)
2. 切换到设备模拟 (Toggle Device Toolbar)
3. 选择 iPhone 或 Android 设备
4. 验证:
   - 阶段头部纵向布局
   - 任务元信息纵向堆叠
   - 内容适应窄屏
   - 字体大小合适

---

## 🐛 常见问题排查

### 问题1: 看不到阶段显示
**可能原因**: 
- process.js 加载失败
- 数据结构错误

**排查步骤**:
1. 打开浏览器控制台,查看错误信息
2. 检查 `SETUP_PROCESSES` 变量是否定义
3. 运行: `console.log(SETUP_PROCESSES.HK.supplier_a)`
4. 确认返回的是对象而非数组

---

### 问题2: 时间计算不正确
**可能原因**:
- 并行任务逻辑错误
- 调整系数应用错误

**排查步骤**:
1. 运行测试脚本 (test-phases.js)
2. 查看 "测试3: 测试时间计算"
3. 检查各阶段时长汇总
4. 验证并行任务是否取最大值

---

### 问题3: 并行任务标识不显示
**可能原因**:
- CSS 未加载
- 并行任务识别逻辑错误

**排查步骤**:
1. 检查 style.css 是否包含 `.parallel-indicator` 样式
2. 在控制台运行:
   ```javascript
   const phase = SETUP_PROCESSES.SG.supplier_a.phases[3];
   console.log(phase.tasks.filter(t => t.parallel));
   ```
3. 确认返回至少2个任务

---

### 问题4: 样式显示异常
**可能原因**:
- CSS 缓存
- 样式冲突

**排查步骤**:
1. 强制刷新页面 (Ctrl/Cmd + Shift + R)
2. 清除浏览器缓存
3. 检查浏览器控制台 Network 标签,确认 style.css 加载成功
4. 查看元素的 Computed Styles

---

## 💡 进阶使用

### 自定义并行任务
编辑 `process.js`,在任务中添加:
```javascript
{
    taskId: 'CUSTOM-T1',
    name: 'Custom Parallel Task 1',
    parallel: true,
    parallelGroup: 'CustomGroup',
    duration: 2,
    // ... 其他字段
}
```

### 添加新国家流程
1. 在 `data.js` 中添加国家信息
2. 在 `process.js` 中添加流程配置:
   ```javascript
   'NewCountry': {
       supplier_a: {
           totalWorkingDays: X,
           phases: [...]
       }
   }
   ```
3. 测试流程计算和展示

---

## 📊 性能监控

在控制台运行以下代码监控性能:
```javascript
// 计时开始
console.time('Timeline Generation');

// 生成timeline
const timeline = generateTimeline('HK', 'supplier_a', 
    { toCountry: 'CN', subRegion: null },
    { shareholders: [], directors: [], services: [] }
);

// 计时结束
console.timeEnd('Timeline Generation');

console.log('生成的阶段数:', timeline.phases.length);
console.log('总任务数:', timeline.phases.reduce((sum, p) => sum + p.tasks.length, 0));
```

**预期结果**: < 10ms

---

## 🎨 样式定制

### 修改阶段标题颜色
编辑 `style.css`:
```css
.phase-header {
    /* 原始: 紫色渐变 */
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    
    /* 改为蓝色渐变: */
    background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
}
```

### 修改并行任务颜色
```css
.parallel-indicator {
    /* 原始: 绿色渐变 */
    background: linear-gradient(90deg, #10b981 0%, #059669 100%);
    
    /* 改为橙色渐变: */
    background: linear-gradient(90deg, #f59e0b 0%, #d97706 100%);
}

.parallel-task {
    /* 原始: 绿色边框 */
    border-left: 4px solid #10b981;
    
    /* 改为橙色边框: */
    border-left: 4px solid #f59e0b;
}
```

---

## 📖 相关文档

- [流程阶段化优化说明.md](./流程阶段化优化说明.md) - 详细的技术文档
- [test-phases.js](./test-phases.js) - 功能测试脚本
- [公司类型联动说明.md](./公司类型联动说明.md) - 公司类型联动功能
- [流程时间线显示问题修复.md](./流程时间线显示问题修复.md) - 之前的问题修复记录

---

## 🙋‍♂️ 获取帮助

如果遇到问题:
1. 查看浏览器控制台错误信息
2. 运行 test-phases.js 测试脚本
3. 参考 "常见问题排查" 章节
4. 查看详细技术文档

---

**祝测试顺利!** 🎉
